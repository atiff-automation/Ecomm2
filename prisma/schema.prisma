generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                        String                   @id @default(cuid())
  email                     String                   @unique
  password                  String
  firstName                 String
  lastName                  String
  phone                     String?
  dateOfBirth               DateTime?
  nric                      String?                  @unique @db.VarChar(12)
  role                      UserRole                 @default(CUSTOMER)
  status                    UserStatus               @default(PENDING_VERIFICATION)
  emailVerified             DateTime?
  isMember                  Boolean                  @default(false)
  memberSince               DateTime?
  membershipTotal           Decimal                  @default(0) @db.Decimal(10, 2)
  createdAt                 DateTime                 @default(now())
  updatedAt                 DateTime                 @updatedAt
  lastLoginAt               DateTime?
  passwordResetToken        String?                  @unique
  passwordResetTokenExpiry  DateTime?
  addresses                 Address[]
  auditLogs                 AuditLog[]
  cartItems                 CartItem[]
  complianceReports         ComplianceReport[]
  discountCodesCreated      DiscountCode[]
  discountUsage             DiscountUsage[]
  heroSectionsCreated       HeroSection[]            @relation("HeroCreator")
  importExportJobs          ImportExportJob[]
  mediaUploads              MediaUpload[]            @relation("MediaUploader")
  notificationPreferences   NotificationPreference[]
  orders                    Order[]
  pendingMembership         PendingMembership?
  recentlyViewed            RecentlyViewed[]
  reviews                   Review[]
  siteCustomizationsCreated SiteCustomization[]      @relation("SiteCustomizationCreator")
  themesCreated             SiteTheme[]              @relation("ThemeCreator")
  telegramConfig            TelegramConfig?
  agentApplications         AgentApplication[]
  applicationReviews        AgentApplicationReview[]
  faqsCreated               FAQ[]                    @relation("FAQCreatedBy")
  faqsUpdated               FAQ[]                    @relation("FAQUpdatedBy")
  faqCategoriesCreated      FAQCategory[]            @relation("FAQCategoryCreatedBy")
  faqCategoriesUpdated      FAQCategory[]            @relation("FAQCategoryUpdatedBy")
  articles                  Article[]                @relation("ArticleAuthor")
  articlesCreated           Article[]                @relation("ArticleCreatedBy")
  articlesUpdated           Article[]                @relation("ArticleUpdatedBy")
  articleCategoriesCreated  ArticleCategory[]        @relation("ArticleCategoryCreatedBy")
  articleCategoriesUpdated  ArticleCategory[]        @relation("ArticleCategoryUpdatedBy")
  landingPages              LandingPage[]            @relation("LandingPageAuthor")
  landingPagesCreated       LandingPage[]            @relation("LandingPageCreatedBy")
  landingPagesUpdated       LandingPage[]            @relation("LandingPageUpdatedBy")
  clickPagesCreated         ClickPage[]              @relation("ClickPageCreatedBy")
  clickPagesUpdated         ClickPage[]              @relation("ClickPageUpdatedBy")

  @@index([email])
  @@index([role])
  @@index([status])
  @@index([isMember])
  @@index([nric])
  @@map("users")
}

model PendingMembership {
  id               String   @id @default(cuid())
  userId           String   @unique
  orderId          String   @unique
  qualifyingAmount Decimal  @db.Decimal(10, 2)
  registrationData Json?
  expiresAt        DateTime
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  order            Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([orderId])
  @@index([expiresAt])
  @@map("pending_memberships")
}

model Address {
  id             String   @id @default(cuid())
  userId         String?
  type           String
  firstName      String
  lastName       String
  company        String?
  addressLine1   String
  addressLine2   String?
  city           String
  state          String
  postalCode     String
  country        String   @default("Malaysia")
  phone          String?
  isDefault      Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  billingOrders  Order[]  @relation("BillingAddress")
  shippingOrders Order[]  @relation("ShippingAddress")

  @@index([userId])
  @@index([postalCode])
  @@map("addresses")
}

model Category {
  id              String            @id @default(cuid())
  name            String
  slug            String            @unique
  description     String?
  image           String?
  parentId        String?
  metaTitle       String?
  metaDescription String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  parent          Category?         @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children        Category[]        @relation("CategoryHierarchy")
  products        ProductCategory[]

  @@index([slug])
  @@index([parentId])
  @@map("categories")
}

model ProductCategory {
  id         String   @id @default(cuid())
  productId  String
  categoryId String
  createdAt  DateTime @default(now())
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, categoryId])
  @@index([productId])
  @@index([categoryId])
  @@map("product_categories")
}

model Product {
  id                        String            @id @default(cuid())
  name                      String
  slug                      String            @unique
  description               String?
  shortDescription          String?
  sku                       String            @unique
  barcode                   String?
  status                    ProductStatus     @default(DRAFT)
  regularPrice              Decimal           @db.Decimal(10, 2)
  memberPrice               Decimal           @db.Decimal(10, 2)
  promotionalPrice          Decimal?          @db.Decimal(10, 2)
  promotionStartDate        DateTime?
  promotionEndDate          DateTime?
  stockQuantity             Int               @default(0)
  lowStockAlert             Int               @default(10)
  weight                    Decimal           @db.Decimal(8, 2)
  metaTitle                 String?
  metaDescription           String?
  metaKeywords              Json?
  featured                  Boolean           @default(false)
  isPromotional             Boolean           @default(false)
  isQualifyingForMembership Boolean           @default(true)
  createdAt                 DateTime          @default(now())
  updatedAt                 DateTime          @updatedAt
  earlyAccessStart          DateTime?
  memberOnlyUntil           DateTime?
  customsDescription        String?
  hsCode                    String?
  shippingClass             ShippingClass     @default(STANDARD)
  dimensions                Json?
  cartItems                 CartItem[]
  orderItems                OrderItem[]
  categories                ProductCategory[]
  images                    ProductImage[]
  variants                  ProductVariant[]
  recentlyViewed            RecentlyViewed[]
  reviews                   Review[]

  @@index([slug])
  @@index([sku])
  @@index([status])
  @@index([featured])
  @@index([isPromotional])
  @@index([regularPrice])
  @@index([promotionStartDate])
  @@index([promotionEndDate])
  @@index([memberPrice])
  @@index([memberOnlyUntil])
  @@index([earlyAccessStart])
  @@map("products")
}

model ProductImage {
  id        String   @id @default(cuid())
  productId String
  url       String
  altText   String?
  sortOrder Int      @default(0)
  isPrimary Boolean  @default(false)
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([sortOrder])
  @@map("product_images")
}

model ProductVariant {
  id            String   @id @default(cuid())
  productId     String
  name          String
  value         String
  sku           String   @unique
  regularPrice  Decimal  @db.Decimal(10, 2)
  memberPrice   Decimal  @db.Decimal(10, 2)
  stockQuantity Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([sku])
  @@map("product_variants")
}

model CartItem {
  id        String   @id @default(cuid())
  userId    String
  productId String
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId])
  @@map("cart_items")
}

model Order {
  id                       String                 @id @default(cuid())
  orderNumber              String                 @unique
  userId                   String?
  guestEmail               String?
  guestMembershipIntent    Json?
  status                   OrderStatus            @default(PENDING)
  paymentStatus            PaymentStatus          @default(PENDING)
  subtotal                 Decimal                @db.Decimal(10, 2)
  taxAmount                Decimal                @default(0) @db.Decimal(10, 2)
  shippingCost             Decimal                @default(0) @db.Decimal(10, 2)
  discountAmount           Decimal                @default(0) @db.Decimal(10, 2)
  total                    Decimal                @db.Decimal(10, 2)
  memberDiscount           Decimal                @default(0) @db.Decimal(10, 2)
  wasEligibleForMembership Boolean                @default(false)
  shippingAddressId        String?
  billingAddressId         String?
  paymentMethod            String?
  paymentId                String?
  trackingNumber           String?
  shippedAt                DateTime?
  deliveredAt              DateTime?
  customerNotes            String?
  adminNotes               String?
  createdAt                DateTime               @default(now())
  updatedAt                DateTime               @updatedAt
  shippingPreferences      Json?
  toyyibpayBillCode        String?
  toyyibpayPaymentUrl      String?
  airwayBillGenerated      Boolean                @default(false)
  airwayBillGeneratedAt    DateTime?
  airwayBillUrl            String?
  trackingUrl              String?
  easyparcelOrderNumber    String? // EasyParcel order number (e.g., "EI-12345")
  easyparcelPaymentStatus  String? // Payment status (e.g., "Fully Paid")
  easyparcelParcelNumber   String? // Parcel number (e.g., "EP-PQKTE")
  shippingCostCharged      Decimal?               @db.Decimal(10, 2) // Actual cost charged
  selectedCourierServiceId String?
  courierName              String?
  courierServiceType       String? // 'parcel' or 'document'
  courierServiceDetail     String? // 'pickup', 'dropoff', 'dropoff or pickup'
  selectedDropoffPointId   String? // Dropoff point ID if applicable
  estimatedDelivery        String?
  shippingWeight           Decimal?               @db.Decimal(8, 2)
  scheduledPickupDate      DateTime?              @db.Date
  overriddenByAdmin        Boolean                @default(false)
  adminOverrideReason      String?                @db.Text
  failedBookingAttempts    Int                    @default(0)
  lastBookingError         String?                @db.Text
  autoStatusUpdate         Boolean                @default(true)
  discountUsage            DiscountUsage[]
  orderItems               OrderItem[]
  billingAddress           Address?               @relation("BillingAddress", fields: [billingAddressId], references: [id])
  shippingAddress          Address?               @relation("ShippingAddress", fields: [shippingAddressId], references: [id])
  user                     User?                  @relation(fields: [userId], references: [id])
  pendingMembership        PendingMembership?
  shipment                 Shipment?
  landingPageConversion    LandingPageConversion?

  @@index([userId])
  @@index([status])
  @@index([paymentStatus])
  @@index([orderNumber])
  @@index([createdAt])
  @@index([selectedCourierServiceId])
  @@index([trackingNumber])
  @@map("orders")
}

model Shipment {
  id                   String             @id @default(cuid())
  orderId              String             @unique
  easyParcelShipmentId String?            @unique
  trackingNumber       String?            @unique
  courierId            String
  courierName          String
  serviceName          String
  serviceType          String // 'parcel' or 'document'
  serviceDetail        String // 'pickup', 'dropoff', 'dropoff or pickup'
  selectedDropoffPoint Json? // Dropoff point details if serviceDetail includes 'dropoff'
  pickupAddress        Json
  deliveryAddress      Json
  parcelDetails        Json
  originalPrice        Decimal            @db.Decimal(10, 2)
  finalPrice           Decimal            @db.Decimal(10, 2)
  insuranceAmount      Decimal?           @db.Decimal(10, 2)
  codAmount            Decimal?           @db.Decimal(10, 2)
  status               ShipmentStatus     @default(DRAFT)
  statusDescription    String?
  estimatedDelivery    DateTime?
  actualDelivery       DateTime?
  labelUrl             String?
  labelGenerated       Boolean            @default(false)
  pickupScheduled      Boolean            @default(false)
  pickupDate           DateTime?
  pickupTimeSlot       String?
  specialInstructions  String?
  signatureRequired    Boolean            @default(false)
  insuranceRequired    Boolean            @default(false)
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  trackingEvents       ShipmentTracking[]
  order                Order              @relation(fields: [orderId], references: [id])

  @@index([orderId])
  @@index([easyParcelShipmentId])
  @@index([trackingNumber])
  @@index([status])
  @@index([courierId])
  @@map("shipments")
}

model ShipmentTracking {
  id          String   @id @default(cuid())
  shipmentId  String
  eventCode   String
  eventName   String
  description String
  location    String?
  eventTime   DateTime
  timezone    String   @default("Asia/Kuala_Lumpur")
  source      String   @default("EASYPARCEL")
  createdAt   DateTime @default(now())
  shipment    Shipment @relation(fields: [shipmentId], references: [id])

  @@index([shipmentId])
  @@index([eventCode])
  @@index([eventTime])
  @@map("shipment_tracking")
}

model OrderItem {
  id             String        @id @default(cuid())
  orderId        String
  productId      String
  quantity       Int
  regularPrice   Decimal       @db.Decimal(10, 2)
  memberPrice    Decimal       @db.Decimal(10, 2)
  appliedPrice   Decimal       @db.Decimal(10, 2)
  totalPrice     Decimal       @db.Decimal(10, 2)
  productName    String
  productSku     String
  discountCodeId String?
  createdAt      DateTime      @default(now())
  discountCode   DiscountCode? @relation(fields: [discountCodeId], references: [id])
  order          Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product        Product       @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@map("order_items")
}

model Review {
  id                 String   @id @default(cuid())
  userId             String
  productId          String
  rating             Int
  title              String?
  comment            String?
  isVerifiedPurchase Boolean  @default(false)
  isApproved         Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  product            Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([productId])
  @@index([rating])
  @@index([isApproved])
  @@map("reviews")
}

model RecentlyViewed {
  id        String   @id @default(cuid())
  userId    String
  productId String
  viewedAt  DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId])
  @@index([viewedAt])
  @@map("recently_viewed")
}

model SystemConfig {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  type      String   @default("string")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([key])
  @@map("system_config")
}

model TelegramConfig {
  id                  String    @id @default(cuid())
  userId              String    @unique
  botToken            String?
  botUsername         String?
  ordersEnabled       Boolean   @default(false)
  ordersChatId        String?
  inventoryEnabled    Boolean   @default(false)
  inventoryChatId     String?
  dailySummaryEnabled Boolean   @default(false)
  summaryTime         String?
  timezone            String    @default("Asia/Kuala_Lumpur")
  verified            Boolean   @default(false)
  lastHealthCheck     DateTime?
  healthStatus        String    @default("UNKNOWN")
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  user                User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([verified])
  @@index([healthStatus])
  @@map("telegram_configs")
}

model AuditLog {
  id         String   @id @default(cuid())
  userId     String?
  action     String
  resource   String
  resourceId String?
  details    Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())
  user       User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([action])
  @@index([resource])
  @@index([createdAt])
  @@map("audit_logs")
}

model ImportExportJob {
  id                 String                @id @default(cuid())
  jobNumber          String                @unique
  type               ImportExportJobType
  status             ImportExportJobStatus @default(PENDING)
  progressPercentage Int                   @default(0)
  totalRecords       Int                   @default(0)
  processedRecords   Int                   @default(0)
  errorCount         Int                   @default(0)
  configuration      Json?
  errorLog           Json?
  resultFileUrl      String?
  startedById        String
  startedAt          DateTime?
  completedAt        DateTime?
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  startedBy          User                  @relation(fields: [startedById], references: [id])

  @@index([startedById])
  @@index([status])
  @@index([type])
  @@index([createdAt])
  @@map("import_export_jobs")
}

model TaxRate {
  id          String   @id @default(cuid())
  name        String   @unique
  rate        Decimal  @db.Decimal(5, 4)
  isActive    Boolean  @default(true)
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive])
  @@map("tax_rates")
}

model ComplianceReport {
  id            String   @id @default(cuid())
  reportType    String
  reportPeriod  String
  reportData    Json
  fileUrl       String?
  generatedById String
  createdAt     DateTime @default(now())
  generatedBy   User     @relation(fields: [generatedById], references: [id])

  @@index([reportType])
  @@index([reportPeriod])
  @@index([generatedById])
  @@map("compliance_reports")
}

model DiscountCode {
  id                     String          @id @default(cuid())
  code                   String          @unique
  name                   String
  description            String?
  discountType           DiscountType
  discountValue          Decimal         @db.Decimal(10, 2)
  minimumOrderValue      Decimal?        @db.Decimal(10, 2)
  maximumDiscount        Decimal?        @db.Decimal(10, 2)
  usageLimit             Int?
  usageCount             Int             @default(0)
  perUserLimit           Int?
  memberOnly             Boolean         @default(false)
  applicableToCategories String[]
  applicableToProducts   String[]
  excludeCategories      String[]
  excludeProducts        String[]
  startsAt               DateTime
  expiresAt              DateTime?
  status                 DiscountStatus  @default(ACTIVE)
  isPublic               Boolean         @default(true)
  createdById            String
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt
  createdBy              User            @relation(fields: [createdById], references: [id])
  usageHistory           DiscountUsage[]
  orderItems             OrderItem[]

  @@index([code])
  @@index([status])
  @@index([memberOnly])
  @@index([startsAt])
  @@index([expiresAt])
  @@index([createdById])
  @@map("discount_codes")
}

model DiscountUsage {
  id             String       @id @default(cuid())
  discountCodeId String
  userId         String
  orderId        String
  discountAmount Decimal      @db.Decimal(10, 2)
  createdAt      DateTime     @default(now())
  discountCode   DiscountCode @relation(fields: [discountCodeId], references: [id], onDelete: Cascade)
  order          Order        @relation(fields: [orderId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([discountCodeId, orderId])
  @@index([discountCodeId])
  @@index([userId])
  @@index([orderId])
  @@map("discount_usage")
}

model NotificationPreference {
  id               String                @id @default(cuid())
  userId           String
  notificationType NotificationType
  emailEnabled     Boolean               @default(true)
  smsEnabled       Boolean               @default(false)
  pushEnabled      Boolean               @default(true)
  inAppEnabled     Boolean               @default(true)
  frequency        NotificationFrequency @default(IMMEDIATE)
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  user             User                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, notificationType])
  @@index([userId])
  @@index([notificationType])
  @@map("notification_preferences")
}

model SiteTheme {
  id              String   @id @default(cuid())
  name            String   @default("Default Theme")
  primaryColor    String   @default("#3B82F6")
  secondaryColor  String   @default("#FDE047")
  backgroundColor String   @default("#F8FAFC")
  textColor       String   @default("#1E293B")
  logoUrl         String?
  logoWidth       Int      @default(120)
  logoHeight      Int      @default(40)
  faviconUrl      String?
  isActive        Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  createdBy       String?
  creator         User?    @relation("ThemeCreator", fields: [createdBy], references: [id])

  @@index([isActive])
  @@map("site_themes")
}

model HeroSection {
  id               String    @id @default(cuid())
  title            String    @default("Welcome to JRM E-commerce")
  subtitle         String    @default("Malaysia's premier online marketplace")
  description      String    @default("Intelligent membership benefits, dual pricing, and local payment integration.")
  ctaPrimaryText   String    @default("Join as Member")
  ctaPrimaryLink   String    @default("/auth/signup")
  ctaSecondaryText String    @default("Browse Products")
  ctaSecondaryLink String    @default("/products")
  backgroundType   MediaType @default(IMAGE)
  backgroundImage  String?
  backgroundVideo  String?
  overlayOpacity   Float     @default(0.1)
  textAlignment    String    @default("left")
  isActive         Boolean   @default(false)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  createdBy        String?
  showCTA          Boolean   @default(true)
  showTitle        Boolean   @default(true)
  creator          User?     @relation("HeroCreator", fields: [createdBy], references: [id])

  @@map("hero_sections")
}

model MediaUpload {
  id           String    @id @default(cuid())
  filename     String
  originalName String
  mimeType     String
  size         Int
  url          String
  mediaType    MediaType
  usage        String?
  uploadedBy   String?
  createdAt    DateTime  @default(now())
  uploader     User?     @relation("MediaUploader", fields: [uploadedBy], references: [id])

  @@map("media_uploads")
}

model SiteCustomization {
  id        String   @id @default(cuid())
  config    Json
  version   Int      @default(1)
  isActive  Boolean  @default(true)
  createdBy String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  creator   User?    @relation("SiteCustomizationCreator", fields: [createdBy], references: [id])

  @@index([isActive])
  @@index([version])
  @@index([createdAt])
  @@map("site_customization")
}

model WebhookQueue {
  id             String        @id @default(cuid())
  trackingNumber String
  eventCode      String
  eventName      String
  eventTime      DateTime
  location       String?
  shipmentId     String
  payload        Json
  status         WebhookStatus @default(PENDING)
  retryCount     Int           @default(0)
  maxRetries     Int           @default(3)
  nextRetryAt    DateTime      @default(now())
  lastError      String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  processedAt    DateTime?
  failedAt       DateTime?

  @@index([status])
  @@index([trackingNumber])
  @@index([nextRetryAt])
  @@index([createdAt])
  @@index([eventCode])
  @@map("webhook_queue")
}

model MalaysianState {
  id        String              @id @db.VarChar(3)
  name      String              @db.VarChar(100)
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt
  postcodes MalaysianPostcode[]

  @@map("malaysian_states")
}

model MalaysianPostcode {
  id        String         @id @default(cuid())
  postcode  String         @db.VarChar(5)
  district  String         @db.VarChar(100)
  stateCode String         @db.VarChar(3)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  state     MalaysianState @relation(fields: [stateCode], references: [id])

  @@unique([postcode, district])
  @@index([postcode])
  @@index([district])
  @@index([stateCode])
  @@map("malaysian_postcodes")
}

model AdminTelegramConfig {
  id                    String   @id @default(cuid())
  botToken              String
  ordersChatId          String
  inventoryChatId       String?
  ordersEnabled         Boolean  @default(true)
  inventoryEnabled      Boolean  @default(true)
  dailySummaryEnabled   Boolean  @default(true)
  timezone              String   @default("Asia/Kuala_Lumpur")
  isActive              Boolean  @unique(map: "unique_active_admin_telegram_config") @default(true)
  createdBy             String?
  updatedBy             String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  chatManagementChatId  String?
  chatManagementEnabled Boolean  @default(true)
  systemAlertsChatId    String?
  systemAlertsEnabled   Boolean  @default(true)

  @@index([isActive])
  @@index([ordersEnabled])
  @@index([inventoryEnabled])
  @@index([chatManagementEnabled])
  @@index([systemAlertsEnabled])
  @@map("admin_telegram_config")
}

model BusinessProfile {
  id                    String                   @id @default(cuid())
  legalName             String
  tradingName           String?
  registrationNumber    String                   @unique
  taxRegistrationNumber String?
  businessType          String                   @default("SDN_BHD")
  registeredAddress     Json
  operationalAddress    Json?
  shippingAddress       Json?
  primaryPhone          String
  secondaryPhone        String?
  primaryEmail          String
  supportEmail          String?
  businessLicense       String?
  industryCode          String?
  establishedDate       DateTime?
  isActive              Boolean                  @default(true)
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @updatedAt
  createdBy             String
  updatedBy             String?
  history               BusinessProfileHistory[]

  @@index([isActive])
  @@index([registrationNumber])
  @@index([taxRegistrationNumber])
  @@map("business_profile")
}

model BusinessProfileHistory {
  id                String          @id @default(cuid())
  businessProfileId String
  operation         String
  oldValues         Json?
  newValues         Json
  changedBy         String
  changeReason      String?
  createdAt         DateTime        @default(now())
  businessProfile   BusinessProfile @relation(fields: [businessProfileId], references: [id], onDelete: Cascade)

  @@index([businessProfileId, createdAt])
  @@index([operation])
  @@index([changedBy])
  @@map("business_profile_history")
}

model TaxConfiguration {
  id                  String    @id @default(cuid())
  gstRegistered       Boolean   @default(false)
  gstNumber           String?   @unique
  sstRegistered       Boolean   @default(false)
  sstNumber           String?   @unique
  defaultGstRate      Decimal   @default(0) @db.Decimal(5, 4)
  defaultSstRate      Decimal   @default(0) @db.Decimal(5, 4)
  taxInclusivePricing Boolean   @default(true)
  autoCalculateTax    Boolean   @default(true)
  isActive            Boolean   @default(true)
  effectiveFrom       DateTime  @default(now())
  effectiveTo         DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  updatedBy           String

  @@index([isActive])
  @@index([gstRegistered])
  @@index([sstRegistered])
  @@index([effectiveFrom, effectiveTo])
  @@map("tax_configuration")
}

model NotificationLog {
  id               String   @id @default(cuid())
  timestamp        DateTime @default(now())
  level            String
  event            String
  channel          String
  userId           String?
  notificationId   String?
  message          String
  metadata         String?
  duration         Int?
  errorName        String?
  errorMessage     String?
  errorStack       String?
  errorCode        String?
  contextIp        String?
  contextUserAgent String?
  contextEndpoint  String?
  contextSessionId String?
  createdAt        DateTime @default(now())

  @@index([timestamp])
  @@index([level])
  @@index([event])
  @@index([channel])
  @@index([userId])
  @@index([notificationId])
  @@index([errorMessage])
  @@map("notification_logs")
}

model FailedNotification {
  id               String    @id @default(cuid())
  type             String
  payload          String
  recipient        String
  channel          String
  failureReason    String
  stackTrace       String?
  retryCount       Int       @default(0)
  nextRetryAt      DateTime?
  metadata         String?
  createdAt        DateTime  @default(now())
  lastAttemptAt    DateTime  @default(now())
  resolvedAt       DateTime?
  permanentFailure Boolean   @default(false)

  @@index([nextRetryAt])
  @@index([retryCount])
  @@index([channel])
  @@index([permanentFailure])
  @@index([resolvedAt])
  @@index([createdAt])
  @@map("failed_notifications")
}

enum UserRole {
  CUSTOMER
  STAFF
  ADMIN
  SUPERADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING_VERIFICATION
}

enum ProductStatus {
  DRAFT
  ACTIVE
  INACTIVE
  OUT_OF_STOCK
  DISCONTINUED
}

enum ShippingClass {
  STANDARD
  FRAGILE
  HAZARDOUS
}

enum OrderStatus {
  PENDING
  PAID
  READY_TO_SHIP
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum ShipmentStatus {
  DRAFT
  RATE_CALCULATED
  BOOKED
  LABEL_GENERATED
  PICKUP_SCHEDULED
  PICKED_UP
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  FAILED
  CANCELLED
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  PASSWORD_RESET
  MEMBERSHIP_GRANTED
  ORDER_PLACED
  PAYMENT_PROCESSED
  BULK_IMPORT
  BULK_EXPORT
  SYSTEM_CONFIG_CHANGE
  USER_STATUS_CHANGE
  MAINTENANCE_MODE_TOGGLE
  ERROR
}

enum ImportExportJobType {
  PRODUCT_IMPORT
  PRODUCT_EXPORT
  ORDER_EXPORT
  CUSTOMER_EXPORT
  INVENTORY_IMPORT
  INVENTORY_EXPORT
  TAX_REPORT
  FULFILLMENT_EXPORT
}

enum ImportExportJobStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
  FREE_SHIPPING
  BUY_X_GET_Y
}

enum DiscountStatus {
  ACTIVE
  INACTIVE
  EXPIRED
  USED_UP
}

enum NotificationType {
  ORDER_CONFIRMATION
  ORDER_STATUS_UPDATE
  SHIPPING_UPDATE
  DELIVERY_UPDATE
  PAYMENT_CONFIRMATION
  PROMOTIONAL_OFFERS
  MEMBER_BENEFITS
  STOCK_ALERTS
  PRICE_DROP_ALERTS
  NEW_ARRIVALS
  NEWSLETTER
  SYSTEM_UPDATES
}

enum NotificationFrequency {
  IMMEDIATE
  DAILY
  WEEKLY
  MONTHLY
}

enum ReferralStatus {
  PENDING
  REGISTERED
  COMPLETED
  EXPIRED
  CANCELLED
}

enum ReferralRewardType {
  DISCOUNT_CODE
  STORE_CREDIT
  CASH_REWARD
  FREE_SHIPPING
  PRODUCT_DISCOUNT
}

enum RewardStatus {
  PENDING
  ISSUED
  USED
  EXPIRED
  CANCELLED
}

enum MediaType {
  IMAGE
  VIDEO
}

enum WebhookStatus {
  PENDING
  RETRY
  PROCESSED
  FAILED
}

enum FAQStatus {
  ACTIVE
  INACTIVE
}

// FAQ Category Model - Dynamic categories managed by admin
model FAQCategory {
  id String @id @default(cuid())

  // Category Name (Language-Neutral)
  name String @unique

  // Additional Info
  description String? // Description for admin reference
  icon        String? // Icon name (e.g., "Info", "Package")

  // Display Order
  sortOrder Int @default(0)

  // Status
  isActive Boolean @default(true)

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?

  // Relations
  faqs          FAQ[]
  createdByUser User? @relation("FAQCategoryCreatedBy", fields: [createdBy], references: [id])
  updatedByUser User? @relation("FAQCategoryUpdatedBy", fields: [updatedBy], references: [id])

  @@index([name])
  @@index([sortOrder])
  @@index([isActive])
  @@map("faq_categories")
}

// FAQ Model
model FAQ {
  id String @id @default(cuid())

  // Content
  question String @db.VarChar(500)
  answer   String @db.Text

  // Organization - Now uses dynamic category
  categoryId String
  category   FAQCategory @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  sortOrder  Int         @default(0)

  // Status
  status FAQStatus @default(ACTIVE)

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?

  // Audit
  createdByUser User? @relation("FAQCreatedBy", fields: [createdBy], references: [id])
  updatedByUser User? @relation("FAQUpdatedBy", fields: [updatedBy], references: [id])

  @@index([categoryId])
  @@index([status])
  @@index([sortOrder])
  @@index([createdAt])
  @@map("faqs")
}

// Agent Application System Models
model AgentApplication {
  id     String                 @id @default(cuid())
  userId String?
  email  String
  status AgentApplicationStatus @default(DRAFT)

  // Step 1: Terms accepted
  acceptTerms Boolean @default(false)

  // Step 2: Basic Information
  fullName    String
  icNumber    String
  phoneNumber String
  address     String
  age         Int

  // Business Experience
  hasBusinessExp   Boolean
  businessLocation String?
  hasTeamLeadExp   Boolean
  isRegistered     Boolean
  jenis            BusinessType

  // Step 3: Social Media
  instagramHandle String?
  facebookHandle  String?
  tiktokHandle    String?
  instagramLevel  SocialMediaLevel @default(TIDAK_MAHIR)
  facebookLevel   SocialMediaLevel @default(TIDAK_MAHIR)
  tiktokLevel     SocialMediaLevel @default(TIDAK_MAHIR)

  // Step 4: Additional Information
  hasJrmExp    Boolean
  jrmProducts  String?
  reasonToJoin String
  expectations String

  // System Fields
  submittedAt DateTime?
  reviewedAt  DateTime?
  reviewedBy  String?
  adminNotes  String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  user    User?                    @relation(fields: [userId], references: [id])
  reviews AgentApplicationReview[]

  @@index([email])
  @@index([status])
  @@index([submittedAt])
  @@index([userId])
  @@map("agent_applications")
}

model AgentApplicationReview {
  id            String              @id @default(cuid())
  applicationId String
  reviewerId    String
  decision      ApplicationDecision
  notes         String?
  createdAt     DateTime            @default(now())

  application AgentApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  reviewer    User             @relation(fields: [reviewerId], references: [id])

  @@map("agent_application_reviews")
}

enum AgentApplicationMalaysianState {
  JOHOR
  KEDAH
  KELANTAN
  KUALA_LUMPUR
  LABUAN
  MELAKA
  NEGERI_SEMBILAN
  PAHANG
  PENANG
  PERAK
  PERLIS
  PUTRAJAYA
  SABAH
  SARAWAK
  SELANGOR
  TERENGGANU
}

enum AgentApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  INTERVIEW_SCHEDULED
  WITHDRAWN
}

enum SocialMediaLevel {
  TIDAK_MAHIR
  MAHIR
  SANGAT_MAHIR
}

enum ApplicationDecision {
  APPROVED
  REJECTED
  NEEDS_MORE_INFO
}

enum EducationLevel {
  SPM
  STPM
  DIPLOMA
  DEGREE
  OTHERS
}

enum EmploymentStatus {
  EMPLOYED
  SELF_EMPLOYED
  UNEMPLOYED
  STUDENT
  RETIRED
}

enum FollowersRange {
  RANGE_0_100
  RANGE_100_1K
  RANGE_1K_10K
  RANGE_10K_PLUS
}

enum HoursRange {
  RANGE_5_10
  RANGE_10_20
  RANGE_20_30
  RANGE_30_PLUS
}

enum IncomeGoal {
  RANGE_500_1000
  RANGE_1000_3000
  RANGE_3000_5000
  RANGE_5000_PLUS
}

enum OpportunityType {
  FULL_TIME
  PART_TIME
  SIDE_HUSTLE
}

enum PostingFrequency {
  DAILY
  WEEKLY
  MONTHLY
  RARELY
}

enum ReferralSource {
  SOCIAL_MEDIA
  FRIEND
  JRM_AGENT
  ONLINE_AD
  OTHERS
}

enum BusinessType {
  KEDAI
  MUDAH
  TIDAK_BERKAITAN
  LAIN_LAIN
}

// Article CMS Models

// Article Status Enum
enum ArticleStatus {
  DRAFT
  PUBLISHED
}

// Article Category Model - Dynamic categories managed by admin
model ArticleCategory {
  id String @id @default(cuid())

  // Category Name
  name        String  @unique
  slug        String  @unique
  description String?

  // Display
  icon      String? // Icon name (e.g., "BookOpen", "Lightbulb")
  color     String? // Hex color for category badge
  sortOrder Int     @default(0)

  // Status
  isActive Boolean @default(true)

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?

  // Relations
  articles      Article[]
  createdByUser User?     @relation("ArticleCategoryCreatedBy", fields: [createdBy], references: [id])
  updatedByUser User?     @relation("ArticleCategoryUpdatedBy", fields: [updatedBy], references: [id])

  @@index([slug])
  @@index([isActive])
  @@index([sortOrder])
  @@map("article_categories")
}

// Article Tag Model - Free-form tags for taxonomy
model ArticleTag {
  id        String   @id @default(cuid())
  name      String   @unique
  slug      String   @unique
  createdAt DateTime @default(now())

  // Relations
  articles ArticleToTag[]

  @@index([slug])
  @@map("article_tags")
}

// Article to Tag Junction Table (Many-to-Many)
model ArticleToTag {
  id        String   @id @default(cuid())
  articleId String
  tagId     String
  createdAt DateTime @default(now())

  article Article    @relation(fields: [articleId], references: [id], onDelete: Cascade)
  tag     ArticleTag @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([articleId, tagId])
  @@index([articleId])
  @@index([tagId])
  @@map("article_to_tags")
}

// Article Model
model Article {
  id String @id @default(cuid())

  // Basic Content
  title            String  @db.VarChar(200)
  slug             String  @unique @db.VarChar(200)
  excerpt          String? @db.VarChar(500)
  content          String  @db.Text // Rich text HTML from TipTap
  featuredImage    String // Required featured image URL
  featuredImageAlt String  @db.VarChar(200)

  // Organization
  categoryId String
  category   ArticleCategory @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  tags       ArticleToTag[]
  sortOrder  Int             @default(0)

  // SEO Fields
  metaTitle       String?  @db.VarChar(200)
  metaDescription String?  @db.VarChar(300)
  metaKeywords    String[] // Array of keywords

  // Author
  authorId String
  author   User   @relation("ArticleAuthor", fields: [authorId], references: [id])

  // Publishing
  status      ArticleStatus @default(DRAFT)
  publishedAt DateTime?

  // Analytics
  viewCount      Int @default(0)
  readingTimeMin Int @default(0) // Auto-calculated

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?

  // Audit Relations
  createdByUser User? @relation("ArticleCreatedBy", fields: [createdBy], references: [id])
  updatedByUser User? @relation("ArticleUpdatedBy", fields: [updatedBy], references: [id])

  @@index([slug])
  @@index([status])
  @@index([publishedAt])
  @@index([categoryId])
  @@index([authorId])
  @@index([sortOrder])
  @@index([viewCount])
  @@index([createdAt])
  @@map("articles")
}

// ============================================================================
// Landing Page CMS Models
// ============================================================================

// Landing Page Status Enum
enum LandingPageStatus {
  DRAFT
  PUBLISHED
  SCHEDULED
}

// Click Page Status Enum
enum ClickPageStatus {
  DRAFT
  PUBLISHED
  SCHEDULED
}

// Click Type Enum for Landing Page Tracking
enum ClickType {
  PRODUCT // Product card click
  CTA // Call-to-action button
  EXTERNAL_LINK // External link click
}

// Landing Page Category Model - Dynamic categories managed by admin
// Landing Page Tag Model - Free-form tags for taxonomy
model LandingPageTag {
  id        String   @id @default(cuid())
  name      String   @unique
  slug      String   @unique
  createdAt DateTime @default(now())

  // Relations
  landingPages LandingPageToTag[]

  @@index([slug])
  @@map("landing_page_tags")
}

// Landing Page to Tag Junction Table (Many-to-Many)
model LandingPageToTag {
  id            String   @id @default(cuid())
  landingPageId String
  tagId         String
  createdAt     DateTime @default(now())

  landingPage LandingPage    @relation(fields: [landingPageId], references: [id], onDelete: Cascade)
  tag         LandingPageTag @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([landingPageId, tagId])
  @@index([landingPageId])
  @@index([tagId])
  @@map("landing_page_to_tags")
}

// Landing Page Model
model LandingPage {
  id String @id @default(cuid())

  // Basic Content
  title            String  @db.VarChar(200)
  slug             String  @unique @db.VarChar(200)
  excerpt          String? @db.VarChar(500)
  content          String  @db.Text // Rich text HTML from TipTap
  featuredImage    String // Required featured image URL
  featuredImageAlt String  @db.VarChar(200)

  // Organization
  tags      LandingPageToTag[]
  sortOrder Int                @default(0)

  // SEO Fields
  metaTitle       String?  @db.VarChar(200)
  metaDescription String?  @db.VarChar(300)
  metaKeywords    String[] // Array of keywords

  // Advanced SEO (Phase 2)
  ogImageUrl      String? // Open Graph image for social sharing
  twitterImageUrl String? // Twitter Card image (optional, falls back to ogImageUrl)
  canonicalUrl    String? // Canonical URL for SEO
  noIndex         Boolean @default(false) // Prevent search engine indexing

  // Analytics & Tracking (Phase 2)
  fbPixelId      String? // Facebook Pixel ID
  gaTrackingId   String? // Google Analytics Tracking ID (e.g., UA-XXXXX-Y or G-XXXXXXX)
  gtmContainerId String? // Google Tag Manager Container ID (e.g., GTM-XXXXXX)
  customScripts  Json? // Custom scripts array: {head: string[], body: string[]}

  // Author
  authorId String
  author   User   @relation("LandingPageAuthor", fields: [authorId], references: [id])

  // Publishing
  status      LandingPageStatus @default(DRAFT)
  publishedAt DateTime?

  // Analytics
  viewCount      Int @default(0)
  readingTimeMin Int @default(0) // Auto-calculated

  // Conversion Tracking (Phase 2)
  clickCount      Int     @default(0) // Total clicks on CTAs/products
  conversionCount Int     @default(0) // Total purchases attributed
  conversionValue Decimal @default(0) @db.Decimal(10, 2) // Total revenue

  // Product Showcase (Phase 2)
  featuredProductIds    String[] @default([]) // Array of product IDs to showcase
  productShowcaseLayout String   @default("GRID") // GRID, CAROUSEL, FEATURED

  // Campaign Scheduling (Phase 2)
  scheduledPublishAt   DateTime? // When to auto-publish
  scheduledUnpublishAt DateTime? // When to auto-unpublish
  campaignName         String? // Campaign identifier
  isScheduled          Boolean   @default(false) // Quick flag for scheduled pages

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?

  // Audit Relations
  createdByUser User? @relation("LandingPageCreatedBy", fields: [createdBy], references: [id])
  updatedByUser User? @relation("LandingPageUpdatedBy", fields: [updatedBy], references: [id])

  // Phase 2 Relations
  clicks      LandingPageClick[]
  conversions LandingPageConversion[]

  @@index([slug])
  @@index([status])
  @@index([publishedAt])
  @@index([authorId])
  @@index([sortOrder])
  @@index([viewCount])
  @@index([createdAt])
  @@index([isScheduled])
  @@index([scheduledPublishAt])
  @@index([scheduledUnpublishAt])
  @@map("landing_pages")
}

// Landing Page Click Event (Phase 2)
model LandingPageClick {
  id            String    @id @default(cuid())
  landingPageId String
  clickType     ClickType // PRODUCT, CTA, EXTERNAL_LINK
  targetUrl     String? // What was clicked
  targetId      String? // Product ID if applicable
  sessionId     String? // Session tracking
  userId        String? // If logged in
  utmSource     String? // UTM tracking
  utmMedium     String?
  utmCampaign   String?
  createdAt     DateTime  @default(now())

  landingPage LandingPage @relation(fields: [landingPageId], references: [id], onDelete: Cascade)

  @@index([landingPageId])
  @@index([clickType])
  @@index([targetId])
  @@index([createdAt])
  @@map("landing_page_clicks")
}

// Landing Page Conversion Event (Phase 2)
model LandingPageConversion {
  id            String   @id @default(cuid())
  landingPageId String
  orderId       String   @unique
  orderValue    Decimal  @db.Decimal(10, 2)
  sessionId     String?
  userId        String?
  utmSource     String?
  utmMedium     String?
  utmCampaign   String?
  createdAt     DateTime @default(now())

  landingPage LandingPage @relation(fields: [landingPageId], references: [id], onDelete: Cascade)
  order       Order       @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([landingPageId])
  @@index([orderId])
  @@index([createdAt])
  @@map("landing_page_conversions")
}

// ============================================================================
// Click Page CMS Models
// ============================================================================

// Click Page Model - Block-based page builder for sales/promotion pages
model ClickPage {
  id String @id @default(cuid())

  // Basic Content
  title String @db.VarChar(200)
  slug  String @unique @db.VarChar(200)

  // Block-based Content (JSON array of blocks)
  blocks Json @default("[]") // Array of block objects

  // SEO Fields
  metaTitle       String?  @db.VarChar(200)
  metaDescription String?  @db.VarChar(300)
  metaKeywords    String[] @default([])

  // Advanced SEO
  ogImageUrl      String?
  twitterImageUrl String?
  canonicalUrl    String?
  noIndex         Boolean @default(false)

  // Analytics & Tracking
  fbPixelId      String?
  gaTrackingId   String?
  gtmContainerId String?
  customScripts  Json? // {head: string[], body: string[]}

  // Publishing
  status      ClickPageStatus @default(DRAFT)
  publishedAt DateTime?

  // Analytics
  viewCount       Int     @default(0)
  clickCount      Int     @default(0) // Total clicks on CTAs/products
  conversionCount Int     @default(0) // Total purchases attributed
  conversionRate  Decimal @default(0) @db.Decimal(5, 2) // Percentage

  // Campaign Scheduling
  scheduledPublishAt   DateTime?
  scheduledUnpublishAt DateTime?
  campaignName         String?   @db.VarChar(100)
  campaignStartDate    DateTime?
  campaignEndDate      DateTime?

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?

  // Audit Relations
  createdByUser User? @relation("ClickPageCreatedBy", fields: [createdBy], references: [id])
  updatedByUser User? @relation("ClickPageUpdatedBy", fields: [updatedBy], references: [id])

  // Relations
  clicks      ClickPageClick[]
  conversions ClickPageConversion[]

  @@index([slug])
  @@index([status])
  @@index([publishedAt])
  @@index([viewCount])
  @@index([createdAt])
  @@index([scheduledPublishAt])
  @@index([scheduledUnpublishAt])
  @@map("click_pages")
}

// Click Page Click Event
model ClickPageClick {
  id          String   @id @default(cuid())
  clickPageId String
  blockId     String? // Which block was clicked
  blockType   String? // Block type that was clicked
  targetUrl   String? // Where the click led
  targetId    String? // Product ID if applicable
  sessionId   String? // Session tracking
  userId      String? // If logged in
  utmSource   String? // UTM tracking
  utmMedium   String?
  utmCampaign String?
  createdAt   DateTime @default(now())

  clickPage ClickPage @relation(fields: [clickPageId], references: [id], onDelete: Cascade)

  @@index([clickPageId])
  @@index([blockId])
  @@index([blockType])
  @@index([targetId])
  @@index([sessionId])
  @@index([createdAt])
  @@map("click_page_clicks")
}

// Click Page Conversion Event
model ClickPageConversion {
  id          String   @id @default(cuid())
  clickPageId String
  orderId     String   @unique
  orderValue  Decimal  @db.Decimal(10, 2)
  sessionId   String?
  userId      String?
  utmSource   String?
  utmMedium   String?
  utmCampaign String?
  createdAt   DateTime @default(now())

  clickPage ClickPage @relation(fields: [clickPageId], references: [id], onDelete: Cascade)

  @@index([clickPageId])
  @@index([orderId])
  @@index([sessionId])
  @@index([createdAt])
  @@map("click_page_conversions")
}
